<template>
	<div class="sidebar">

		<slot name="top"/>

		<!-- Home logo -->
		<router-link :to="$localePath" class="logo home-link">
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256.81 74.17"><g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><path class="cls-1" d="M27.52,4.67c.37,10.66.91,21.33,1.92,31.92.5,5.3,1.09,10.58,1.9,15.8.39,2.62.89,5.19,1.43,7.74.3,1.26.59,2.53.95,3.72a22.15,22.15,0,0,0,1.22,3.33l.09.2c.58,1.25-.22,2.13-1.48,2.71s-2.43.65-3-.55a25.91,25.91,0,0,1-1.66-4.16c-.45-1.36-.78-2.7-1.14-4-.63-2.68-1.2-5.36-1.66-8-.95-5.36-1.67-10.72-2.3-16.08-1.25-10.74-2-21.49-2.63-32.25h0c0-3.48,1.52-3.95,3.1-4.74,2.33-1.17,3.18,2.61,3.28,4.38Z"/><path class="cls-1" d="M47.44,8.13c.33,3.5.68,7,1.16,10.47s1,7,1.62,10.41,1.34,6.89,2.18,10.27c.42,1.69.87,3.37,1.38,5,.25.81.52,1.62.82,2.37.14.37.29.77.44,1.07s.16.36.22.46a1.3,1.3,0,0,1,.14.26l.32.72c1.18,2.35,2,4.91.91,5.41-1,.42-3.59-1.27-4.76-3.18-.18-.29-.4-.56-.59-.85s-.26-.48-.4-.72c-.27-.48-.44-.92-.64-1.36-.4-.89-.72-1.76-1-2.63-.63-1.74-1.18-3.47-1.69-5.21-1-3.48-1.92-7-2.72-10.5s-1.51-7-2.14-10.59S41.48,12.42,41,8.85a5.77,5.77,0,0,1,2.63-5c2.09-1.27,3.56,2.32,3.8,4.1a.59.59,0,0,1,0,.13Z"/><path class="cls-1" d="M1.79,52.68a134.81,134.81,0,0,1,13.44-6.49q6.82-2.91,13.8-5.37t14-4.64c2.36-.72,4.72-1.42,7.11-2.06q1.78-.49,3.6-.93a35.14,35.14,0,0,1,3.83-.75,1.49,1.49,0,0,1,.5,2.94l-.23,0c-1,.21-2.18.54-3.32.89s-2.3.73-3.45,1.12c-2.3.77-4.6,1.6-6.88,2.45q-6.84,2.55-13.55,5.41c-4.47,1.9-8.89,3.91-13.19,6.06a125.78,125.78,0,0,0-12.41,7c-1.51,1-3.57-.87-4.55-2.38s-.52-2.1,1-3.08l.16-.1Z"/><path class="cls-1" d="M70.38,40.3c3-1.45,5.9-2.81,8.71-4.32A42.36,42.36,0,0,0,86.79,31a10.89,10.89,0,0,0,2.51-2.88,3.54,3.54,0,0,0,.46-2.6,3.87,3.87,0,0,0-.2-.67,3.52,3.52,0,0,0-.16-.35,2.31,2.31,0,0,0-.14-.28c-.06-.11-.09-.09,0,0a1.09,1.09,0,0,0,.51.23c.37,0,.13,0-.22.25a6.58,6.58,0,0,0-1.23,1.07,19.76,19.76,0,0,0-4,7.17c-.86,2.64-1.09,5.45-.37,7.39a5.09,5.09,0,0,0,1.65,2.34,8.2,8.2,0,0,0,3,1.44,13.29,13.29,0,0,0,1.92.39c.71.07,1.43.2,2.13.21a18.72,18.72,0,0,0,4.12-.18,16.35,16.35,0,0,0,7.29-3,27.53,27.53,0,0,0,5.92-6.29c.9-1.25,1.77-2.58,2.75-4,.48-.71,1-1.45,1.63-2.22a11,11,0,0,1,2.7-2.53,6.13,6.13,0,0,1,3-1,4.68,4.68,0,0,1,2.63.72,5.81,5.81,0,0,1,1.31,1.14,8.55,8.55,0,0,1,1.13,1.76c.25.5.45,1,.63,1.43.68,1.79,1.13,3.41,1.59,5,.93,3.18,1.69,6.28,2.79,9.1a25.52,25.52,0,0,0,1.83,3.89,6.84,6.84,0,0,0,2.26,2.48,3.34,3.34,0,0,0,2.75.29,12.55,12.55,0,0,0,3.65-1.79,49.17,49.17,0,0,0,7-6.29v0c1.68-2,2.94-2.93,3.54-2.36s.12,2.4-1.19,4.22a48.23,48.23,0,0,1-6.51,8,15.91,15.91,0,0,1-4.85,3.13,9.64,9.64,0,0,1-3.3.67,8.18,8.18,0,0,1-3.55-.72A12.43,12.43,0,0,1,126.83,52a26.47,26.47,0,0,1-2.76-4.82,87.88,87.88,0,0,1-3.54-9.58c-.5-1.54-1-3.08-1.54-4.34a8.77,8.77,0,0,0-.4-.81,1,1,0,0,0-.2-.31,1.81,1.81,0,0,0,.39.33,3.21,3.21,0,0,0,.6.27,3.26,3.26,0,0,0,.86.11l.22,0h.16a1.89,1.89,0,0,0,.18-.06s.15-.07.13,0-.13.11-.28.26l-.25.28-.29.36c-.4.51-.82,1.11-1.26,1.77-.87,1.31-1.77,2.74-2.78,4.17a34.81,34.81,0,0,1-7.47,8.09,23.35,23.35,0,0,1-10.74,4.47,26.13,26.13,0,0,1-5.71.2c-1,0-1.86-.18-2.78-.29a19.94,19.94,0,0,1-2.91-.62,14.84,14.84,0,0,1-5.73-3,12.55,12.55,0,0,1-3.79-5.74,15.91,15.91,0,0,1-.62-6.31,23.18,23.18,0,0,1,1.26-5.67A27,27,0,0,1,80,25.62a23.2,23.2,0,0,1,3.55-4.56,13.23,13.23,0,0,1,2.61-2A7.82,7.82,0,0,1,88,18.23,6.09,6.09,0,0,1,90.61,18a5.42,5.42,0,0,1,2.73,1.2,6.21,6.21,0,0,1,1.55,1.91,8.3,8.3,0,0,1,.39.83c.1.26.22.51.31.79A10.42,10.42,0,0,1,96,24.45a9.17,9.17,0,0,1-.09,3.65,11,11,0,0,1-1.32,3.21,16.74,16.74,0,0,1-4.14,4.34,37.69,37.69,0,0,1-9.39,4.82,65.48,65.48,0,0,1-9.74,2.67c-.82.16-4.28.36-4.44-.46s2.89-2.09,3.48-2.38Z"/><path class="cls-1" d="M150.47,31.73a32.3,32.3,0,0,0,3.17,6.72,25.58,25.58,0,0,0,5.17,6.35c2,1.71,4.38,2.86,6.24,2.52a4.33,4.33,0,0,0,2.5-1.53,9.65,9.65,0,0,0,1.74-3.26,23.3,23.3,0,0,0,.88-4c.1-.69.15-1.36.21-2a15.16,15.16,0,0,0-.18-1.82,4.54,4.54,0,0,0-.45-1.37.27.27,0,0,1-.09-.12s0,0,0,0,.09.07.14,0,.16,0,.23,0c.3-.06.39-.19.47-.51,0-.08,0-.15,0-.21s0,0,0-.06l0,0c-.06,0,.06,0,.28.2a9.11,9.11,0,0,0,3.38,1.18,9,9,0,0,0,3.58-.19A8.74,8.74,0,0,0,180.86,32a18.75,18.75,0,0,0,1.86-1.62c.43-.45.82-1.21,1.23-1.7,1-1.2,4.49-.8,4.54,1.14a82,82,0,0,0,1.6,10.5,29.52,29.52,0,0,0,1.58,4.5,12.13,12.13,0,0,0,2.31,3.6,4.21,4.21,0,0,0,1.37.94,3,3,0,0,0,1.48.14,8,8,0,0,0,3.47-2A23.17,23.17,0,0,0,203.5,44a5.59,5.59,0,0,0,1-1.63,5.12,5.12,0,0,1,1.36-2.24,4,4,0,0,1,.89-.79,2.24,2.24,0,0,1,2.9.36,3.94,3.94,0,0,1,.68,1c.12.27.21.49.3.72.17.44.37,1.61.51,2l.83,2.42c.56,1.6,1.15,3.14,1.77,4.76,1.18,3.21,2.39,6.36,3.76,9.39a48.42,48.42,0,0,0,2.24,4.37A17.12,17.12,0,0,0,222.44,68a4,4,0,0,0,1.38,1,1,1,0,0,0,.81,0,2.81,2.81,0,0,0,1-.75,6.32,6.32,0,0,0,.58-.71l.56-.85.09-.14a2.87,2.87,0,1,1,4.8,3.13,2.1,2.1,0,0,1-.22.3c-.33.39-.65.78-1,1.16a14.57,14.57,0,0,1-1.21,1.12A7.55,7.55,0,0,1,225.8,74a6.16,6.16,0,0,1-4.14-.63A9.31,9.31,0,0,1,219,71.25,22.56,22.56,0,0,1,216,66.49c-.83-1.6-1.53-3.22-2.18-4.84-1.33-3.23-2.42-6.5-3.58-9.69-.57-1.58-1.18-3.23-1.73-4.85l-.83-2.42c-.13-.39-.27-.78-.41-1.13-.07-.17-.14-.34-.2-.46s-.15-.22,0-.05a1.45,1.45,0,0,0,.86.41,1.5,1.5,0,0,0,.61-.06,1.66,1.66,0,0,0,.29-.12c.17-.12,0,0,0,.07s-.46.58-.72.92l-.77,1-.78,1a28.9,28.9,0,0,1-3.59,4.09,11.67,11.67,0,0,1-5.28,3,7.11,7.11,0,0,1-3.57-.16,8.33,8.33,0,0,1-2.94-1.73,16.42,16.42,0,0,1-3.46-4.76,41,41,0,0,1-2.09-5,79.66,79.66,0,0,1-2.7-10.27h0l5,1.36a21,21,0,0,1-4,3.45,13.71,13.71,0,0,1-5.06,2,14.12,14.12,0,0,1-5.42,0,14.39,14.39,0,0,1-5-2,4.41,4.41,0,0,1-2.13-3.71A3.82,3.82,0,0,1,169.37,29a4.69,4.69,0,0,1,1.35,0,5.22,5.22,0,0,1,1.18.49,5.74,5.74,0,0,1,.87.72c.21.25.42.51.61.77a8.71,8.71,0,0,1,1,2.89,17.57,17.57,0,0,1,.24,2.69c-.05.84-.11,1.68-.21,2.49a26.34,26.34,0,0,1-1,4.84A15.28,15.28,0,0,1,171,48.65a9,9,0,0,1-5,3.25,10.39,10.39,0,0,1-5.81-.43,19.05,19.05,0,0,1-4.66-2.5,28,28,0,0,1-3.79-3.3A38.89,38.89,0,0,1,148.56,42a62.22,62.22,0,0,1-5.31-8.12l0,0c-1-1.83.14-3.28,2.09-4.05,2.31-.91,3-2.16,4.06-.34C149.5,29.64,150.4,31.5,150.47,31.73Z"/><path class="cls-1" d="M231.64,23.4a43.27,43.27,0,0,0-2.79-4,16.57,16.57,0,0,0-1.46-1.6,6,6,0,0,0-1.3-.94.55.55,0,0,0-.26-.07s.14.06.33,0a1.08,1.08,0,0,0,.41-.21c.06-.06,0,0,0,.07a4.66,4.66,0,0,0-.26,1.25,8.36,8.36,0,0,0,.07,1.91,30,30,0,0,0,3,8.76,37.29,37.29,0,0,0,6.09,8.5,48.33,48.33,0,0,0,3.89,3.68c1.36,1.17,2.73,2.33,4.14,3.47,2.78,2.31,5.67,4.48,8.45,7.12a24.73,24.73,0,0,1,2,2.15,13.78,13.78,0,0,1,1.85,2.72,8.25,8.25,0,0,1,.93,3.87,7.91,7.91,0,0,1-1.26,4A17.68,17.68,0,0,1,250.71,69c-1.68,1.24-3.37,2.25-5.06,3.29l-.07,0c-2.17,1.34-7.75-.5-9.09-2.68S245.57,63,247,62.48a10.91,10.91,0,0,0,3.49-2,2.44,2.44,0,0,0,.66-.93,2.26,2.26,0,0,0-.05-1.4,12.37,12.37,0,0,0-2.34-3.92,79.13,79.13,0,0,0-7.44-7.58l-4-3.7c-1.32-1.25-2.66-2.48-4-3.68s-2.78-2.39-4.21-3.59a43.1,43.1,0,0,1-4.22-3.95,21.41,21.41,0,0,1-5.66-10.86,15.8,15.8,0,0,1-.23-3.49,10.14,10.14,0,0,1,1-4,7.66,7.66,0,0,1,1.54-2.14,6.26,6.26,0,0,1,5.74-1.61,8.08,8.08,0,0,1,2.26.89A11,11,0,0,1,232.4,13a17.71,17.71,0,0,1,1.89,2.64,25.68,25.68,0,0,1,2.39,5.47c.45,1.47.62,4.44-1.41,4.26a5.33,5.33,0,0,1-3.59-1.94Z"/><path class="cls-1" d="M207.85,3.71a6.46,6.46,0,0,1,3.86-.09l.71.23c.21.09.41.19.6.29a6.16,6.16,0,0,1,1.08.64,9.07,9.07,0,0,1,3,3.6c.08.19.17.38.24.58s.14.45.19.68a5.16,5.16,0,0,1,.16,1.45,5,5,0,0,1-.28,1.51,6.1,6.1,0,0,1-.71,1.28,8.06,8.06,0,0,1-.92.85,6,6,0,0,1-.94.53,3.53,3.53,0,0,1-.9.33l-.87.23a1.86,1.86,0,0,1-2.13-1.1c-.14-.56.35-1.11.75-1.47l.23-.2c.6-.54,1.11-1.22.94-1.49a8.68,8.68,0,0,0-1.23.24c.32-.07-4.61,1.07-6.08-2.2A4.45,4.45,0,0,1,207.85,3.71Z"/></g></g></svg>
		</router-link>


		<!-- Navlinks -->
		<ul class="sidebar-links" v-if="items.length">
			<li v-for="(item, i) in items" :key="i">
				<SidebarGroup v-if="item.type === 'group'"
				:item="item"
				:first="i === 0"
				:open="i === openGroupIndex"
				:collapsable="item.collapsable"
				@toggle="toggleGroup(i)"/>
				<SidebarLink v-else :item="item"/>
			</li>
		</ul>

		<!-- Search -->
		<AlgoliaSearchBox v-if="isAlgoliaSearch" :options="algolia"/>
		<SearchBox v-else-if="$site.themeConfig.search !== false"/>

		<!-- Github -->
		<NavLinks />
		<slot name="bottom"/>
	</div>
</template>

<script>
import AlgoliaSearchBox from '@AlgoliaSearchBox';
import SearchBox from './SearchBox.vue';

import SidebarGroup from './SidebarGroup.vue';
import SidebarLink from './SidebarLink.vue';
import NavLinks from './NavLinks.vue';
import { isActive } from './util';
export default {
  components: { SidebarGroup, SidebarLink, NavLinks, SearchBox, AlgoliaSearchBox},
  props: ['items'],
  data () {
    return {
      openGroupIndex: 0
    }
  },
  created () {
    this.refreshIndex()
  },
  watch: {
    '$route' () {
      this.refreshIndex()
    }
  },
  methods: {
    refreshIndex () {
      const index = resolveOpenGroupIndex(
        this.$route,
        this.items
      )
      if (index > -1) {
        this.openGroupIndex = index
      }
    },
    toggleGroup (index) {
      this.openGroupIndex = index === this.openGroupIndex ? -1 : index
    },
    isActive (page) {
      return isActive(this.$route, page.path)
    }
  },
	computed: {
    algolia () {
      return this.$themeLocaleConfig.algolia || this.$site.themeConfig.algolia || {}
    },
    isAlgoliaSearch () {
      return this.algolia && this.algolia.apiKey && this.algolia.indexName
    }
  }
}
function resolveOpenGroupIndex (route, items) {
  for (let i = 0; i < items.length; i++) {
    const item = items[i]
    if (item.type === 'group' && item.children.some(c => isActive(route, c.path))) {
      return i
    }
  }
  return -1
}
</script>

<style lang="scss">
@import '~henris';
@import './styles/custom-colors';

@import './styles/config';
.search-box {
	margin: grid(.2) 3rem 4rem;
	@media #{$small-only} {
		margin: rem(50) 3rem 0;
	}
}


.logo svg{
	width: 100%;
	padding: 2rem 5rem;
	margin: 0 0 grid(.3);
	height: auto;
	@media #{$small-only} {
		display: none;
	}
}

.sidebar{
	ul{
		padding: 0;
		margin: 0;
		list-style-type: none;
	}
	a{
		display: inline-block;
	}
	.nav-links{
		margin-top: grid(4);
		border-bottom: 1px solid color(borderColor);
		padding: 0.5rem 0 0.75rem 0;
		a{
			font-weight: 600;
		}
		.nav-item, .repo-link{
			display: block;
			line-height: 1.25rem;
			font-size: 1.1em;
			padding: 0.5rem 0 0.5rem 2rem;
		}
	}
	.sidebar-links{
		padding: 1.5rem 0;
		display: flex;
		flex-direction: column;
	}
}
@media #{$small-only}{
	.sidebar{
		.nav-links{
			display: block;
			.dropdown-wrapper .nav-dropdown .dropdown-item a.router-link-active::after{
				top: calc(1rem - 2px);
			}
		}
		.sidebar-links{
			padding: 1rem 0;
		}
	}
}
</style>
